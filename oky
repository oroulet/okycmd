#!/usr/bin/python

import ConfigParser
import sys
import onkyo

def usage():
    print """
    Usage:  oky [options] [zone] command arguments
    examples:
        oky state               ; print state
        oky source PC           ; set source to PC
        oky z2 source SOURCE       ; set zone 2 source to the same as main zone
        oky on                  ; power on main zone
        oky z2 off              ; shut down zone 2
        oky +                   ; increase volume
        oky -                   ; decrease volume
        
        """

def get_config_file():
    return "/home/olivier/.okyrc"

def save_ip(ip):
    f = open(get_config_file())
    f.write(ip)
    f.close()

def get_ip():
    f = open(get_config_file())
    ip =  f.readline()
    f.close()
    return ip


if __name__ == "__main__":
    if not len(sys.argv) > 1:
        usage()
    else:
        cmd = sys.argv[1]
        cmd2 = ""
        cmd3 = ""
        if len(sys.argv) > 2:
            cmd2 = sys.argv[2]
        if len(sys.argv) > 3:
            cmd3 = sys.argv[3]

        if cmd in ("-h", "-help", "help"):
            usage()
        elif cmd in ("ip", "address"):
            save_ip( cmd2 )
            print "stored default ip address:", ip

        #ip = get_ip()

        #oky = onkyo.Onkyo(ip)
        oky = onkyo.Onkyo()
        oky.connect()


        if cmd == "z2":
            if cmd2 == "off":
                oky.z2off()
            elif cmd2 == "on":
                oky.z2power()
            elif cmd2 == "+":
                oky.z2volumeUp()
            elif cmd2 == "-":
                oky.z2volumeDown()
            elif cmd2 == "source":
                if cmd3:
                    oky.z2setSource(cmd3)
                else:
                    source =  oky.z2getSource()
                    print "Source is: ", source
            else:
                usage()
        elif cmd == "state":
            oky.printState()
        elif cmd == "off":
            oky.off()
        elif cmd == "on":
            oky.power()
        elif cmd == "source":
            if cmd2:
                oky.setSource(cmd2)
            else:
                source =  oky.getSource()
                print "Source is: ", source
        elif cmd == "+":
            val = oky.volumeUp()
            print "Volume: ", val
        elif cmd == "-":
            val = oky.volumeDown()
            print "Volume: ", val
        else:
            usage()
        oky.close()


